<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#111111">
<link rel="manifest" href="manifest.json">
<title>Delivery | Drogaria Rocha</title>

<style>
:root{
  --laranja:#ff6a00;
  --preto:#111;
  --cinza:#f2f2f2;
  --borda:#ddd;
  --danger:#b00020;
  --ok:#0a8f3c;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--cinza)}
header{background:var(--preto);color:#fff;padding:14px}
header span{color:var(--laranja)}
.container{padding:12px;max-width:1200px;margin:auto}

.card{
  background:#fff;border-radius:8px;padding:14px;margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.card h3{margin:0 0 10px;border-left:4px solid var(--laranja);padding-left:8px}

input,select{
  width:100%;padding:8px;margin:5px 0 10px;border:1px solid var(--borda);border-radius:6px;
}
button{border:none;border-radius:6px;padding:8px;font-weight:700;cursor:pointer}
.btn-main{background:var(--laranja);color:#fff;width:100%}
.btn-dark{background:var(--preto);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-ok{background:var(--ok);color:#fff}
.btn-small{font-size:12px;margin:2px}

table{width:100%;border-collapse:collapse}
th{background:var(--preto);color:#fff;padding:8px;font-size:12px}
td{padding:8px;border-bottom:1px solid var(--borda);font-size:12px}

.badge{padding:4px 8px;border-radius:999px;font-size:11px;font-weight:700}
.Aguardando{background:#eee}
.Em\ rota{background:#ffe0c2;color:#b34700}
.Entregue{background:#d4f7d4;color:#006400}
.Cancelado{background:#ffd6d6;color:#8b0000}
</style>
</head>

<body>

<header>
  <h3>Delivery — <span>Drogaria Rocha</span></h3>
</header>

<div class="container">

<!-- NOVO PEDIDO -->
<div class="card">
  <h3>Novo Pedido</h3>
  <input type="date" id="dataPedido">
  <input id="cliente" placeholder="Cliente">
  <input id="telefone" placeholder="Telefone (somente números)">
  <input id="pedido" placeholder="Pedido">
  <input id="valor" placeholder="Valor">
  <button class="btn-main" onclick="addPedido()">Adicionar Pedido</button>
</div>

<!-- PEDIDOS -->
<div class="card">
  <h3>Pedidos do Dia</h3>
  <table>
    <thead>
      <tr>
        <th>Cliente</th><th>Pedido</th><th>Valor</th><th>Status</th><th>Ações</th>
      </tr>
    </thead>
    <tbody id="lista"></tbody>
  </table>
</div>

<!-- FECHAMENTO -->
<div class="card">
  <h3>Fechamento do Dia</h3>
  <button class="btn-ok" onclick="fecharDia()">Fechar Dia</button>
</div>

<!-- RELATÓRIOS -->
<div class="card">
  <h3>Relatórios</h3>
  <label>Período inicial</label>
  <input type="date" id="repIni">
  <label>Período final</label>
  <input type="date" id="repFim">
  <button class="btn-dark" onclick="relatorioPeriodo()">Gerar Relatório</button>
</div>

</div>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}

const STORAGE="rocha_delivery_full";
let pedidos=JSON.parse(localStorage.getItem(STORAGE))||[];

function hoje(){return new Date().toISOString().split("T")[0]}
dataPedido.value=hoje(); repIni.value=hoje(); repFim.value=hoje();

function salvar(){localStorage.setItem(STORAGE,JSON.stringify(pedidos))}
function fmt(v){return Number(v).toFixed(2).replace(".",",")}

function addPedido(){
  pedidos.push({
    data:dataPedido.value,
    cliente:cliente.value,
    telefone:telefone.value.replace(/\D/g,""),
    pedido:pedido.value,
    valor:parseFloat(valor.value.replace(",",".")),
    status:"Aguardando"
  });
  cliente.value=telefone.value=pedido.value=valor.value="";
  salvar(); render();
}

function mudarStatus(i,status){
  let hojePedidos=pedidos.filter(p=>p.data===hoje());
  pedidos[pedidos.indexOf(hojePedidos[i])].status=status;
  salvar(); render();
}

function excluirPedido(i){
  if(!confirm("Excluir pedido?"))return;
  let hojePedidos=pedidos.filter(p=>p.data===hoje());
  pedidos.splice(pedidos.indexOf(hojePedidos[i]),1);
  salvar(); render();
}

function fecharDia(){
  alert("Dia fechado e salvo.");
}

function relatorioPeriodo(){
  let ini=repIni.value,fim=repFim.value;
  let lista=pedidos.filter(p=>p.data>=ini&&p.data<=fim);
  let txt="RELATÓRIO\n\n";
  lista.forEach(p=>{
    txt+=`${p.data} | ${p.cliente} | ${p.pedido} | R$ ${fmt(p.valor)} | ${p.status}\n`;
  });
  let blob=new Blob([txt],{type:"text/plain"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="relatorio.txt";
  a.click();
}

function render(){
  lista.innerHTML="";
  pedidos.filter(p=>p.data===hoje()).forEach((p,i)=>{
    lista.innerHTML+=`
      <tr>
        <td>${p.cliente}</td>
        <td>${p.pedido}</td>
        <td>R$ ${fmt(p.valor)}</td>
        <td><span class="badge ${p.status}">${p.status}</span></td>
        <td>
          <button class="btn-small btn-dark" onclick="mudarStatus(${i},'Em rota')">Em rota</button>
          <button class="btn-small btn-dark" onclick="mudarStatus(${i},'Entregue')">Entregue</button>
          <button class="btn-small btn-danger" onclick="excluirPedido(${i})">Excluir</button>
        </td>
      </tr>`;
  });
}
render();
</script>

</body>
</html>
