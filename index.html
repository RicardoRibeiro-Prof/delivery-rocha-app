<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">

<!-- PWA -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#111111">
<link rel="manifest" href="manifest.json">

<title>Delivery | Drogaria Rocha</title>

<style>
:root{
  --laranja:#ff6a00;
  --preto:#111;
  --cinza:#f2f2f2;
  --borda:#ddd;
  --ok:#0a8f3c;
  --danger:#b00020;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--cinza)}
header{background:var(--preto);color:#fff;padding:14px}
header span{color:var(--laranja)}

.container{padding:12px;max-width:1100px;margin:auto}

/* DASHBOARD */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
  gap:8px;
  margin-bottom:12px;
}
.kpi{
  background:#fff;
  border-radius:8px;
  padding:10px;
  text-align:center;
  font-weight:700;
}
.kpi small{display:block;color:#666}

/* CARD */
.card{
  background:#fff;
  border-radius:8px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.card h3{
  margin:0 0 10px;
  border-left:4px solid var(--laranja);
  padding-left:8px;
}

label{font-size:12px;font-weight:700;color:#555}
input{
  width:100%;
  padding:8px;
  margin:5px 0 10px;
  border:1px solid var(--borda);
  border-radius:5px;
}

button{
  border:none;
  border-radius:5px;
  padding:8px;
  font-weight:700;
  cursor:pointer;
}
.btn-main{background:var(--laranja);color:#fff;width:100%}
.btn-dark{background:var(--preto);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-small{font-size:12px;margin:2px}

/* TABELA */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;min-width:620px}
th{background:var(--preto);color:#fff;padding:8px;font-size:12px}
td{padding:8px;border-bottom:1px solid var(--borda);font-size:12px}

.badge{
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:700;
}
.Aguardando{background:#eee}
.Em\ rota{background:#ffe0c2;color:#b34700}
.Entregue{background:#d4f7d4;color:#006400}

.footer{background:#fff;border-radius:8px;padding:12px;font-weight:700}
</style>
</head>

<body>

<header>
  <h3>Delivery â€” <span>Drogaria Rocha</span></h3>
</header>

<div class="container">

  <!-- DASHBOARD -->
  <div class="dashboard">
    <div class="kpi"><small>Pedidos</small><div id="kPedidos">0</div></div>
    <div class="kpi"><small>Total</small><div id="kTotal">0,00</div></div>
    <div class="kpi"><small>Entregues</small><div id="kEnt">0</div></div>
  </div>

  <!-- FORM -->
  <div class="card">
    <h3>Novo Pedido</h3>

    <label>Data</label>
    <input type="date" id="dataPedido">

    <label>Cliente</label>
    <input id="cliente">

    <label>Telefone (somente nÃºmeros)</label>
    <input id="telefone">

    <label>Pedido</label>
    <input id="pedido">

    <label>Valor (R$)</label>
    <input id="valor">

    <button class="btn-main" onclick="addPedido()">Adicionar Pedido</button>
  </div>

  <!-- LISTA -->
  <div class="card">
    <h3>Pedidos de Hoje</h3>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Pedido</th>
            <th>Valor</th>
            <th>Status</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody id="lista"></tbody>
      </table>
    </div>
  </div>

  <div class="footer" id="resumo"></div>

</div>

<script>
/* SERVICE WORKER */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}

/* DADOS */
const STORAGE="rocha_delivery_pwa";
let pedidos=JSON.parse(localStorage.getItem(STORAGE))||[];

function hoje(){return new Date().toISOString().split("T")[0]}
dataPedido.value=hoje();

function salvar(){localStorage.setItem(STORAGE,JSON.stringify(pedidos))}

function fmt(v){return v.toFixed(2).replace(".",",")}

function addPedido(){
  if(!cliente.value||!telefone.value||!pedido.value||!valor.value){
    alert("Preencha todos os campos");
    return;
  }
  pedidos.push({
    data:dataPedido.value,
    cliente:cliente.value,
    telefone:telefone.value.replace(/\D/g,""),
    pedido:pedido.value,
    valor:parseFloat(valor.value.replace(",",".")),
    status:"Aguardando"
  });
  cliente.value=telefone.value=pedido.value=valor.value="";
  salvar();render();
}

/* âœ… WHATSAPP BUSINESS FORÃ‡ADO */
function abrirWhats(p,tipo){
  let msg = tipo==="rota"
    ?`OlÃ¡ ${p.cliente}! ðŸ‘‹ Seu pedido saiu para entrega ðŸš´â€â™‚ï¸`
    :`OlÃ¡ ${p.cliente}! ðŸ˜Š Seu pedido foi entregue com sucesso âœ… Obrigado ðŸ§¡`;

  const texto = encodeURIComponent(msg);
  const tel = `55${p.telefone}`;
  const isMobile = /Android/i.test(navigator.userAgent);

  if(isMobile){
    // FORÃ‡A WHATSAPP BUSINESS
    window.location.href =
      `intent://send/?phone=${tel}&text=${texto}` +
      `#Intent;scheme=whatsapp;package=com.whatsapp.w4b;end`;
  }else{
    window.location.href =
      `https://web.whatsapp.com/send?phone=${tel}&text=${texto}`;
  }
}

function mudarStatus(i,status){
  let hojePedidos=pedidos.filter(p=>p.data===hoje());
  let p=hojePedidos[i];
  let idx=pedidos.indexOf(p);
  pedidos[idx].status=status;
  salvar();render();
  if(status==="Em rota")abrirWhats(p,"rota");
  if(status==="Entregue")abrirWhats(p,"entregue");
}

function excluirPedido(i){
  if(!confirm("Excluir este pedido?")) return;
  let hojePedidos=pedidos.filter(p=>p.data===hoje());
  let p=hojePedidos[i];
  pedidos.splice(pedidos.indexOf(p),1);
  salvar();render();
}

function render(){
  let hojePedidos=pedidos.filter(p=>p.data===hoje());
  lista.innerHTML="";
  let total=0,ent=0;

  hojePedidos.forEach((p,i)=>{
    total+=p.valor;
    if(p.status==="Entregue")ent++;
    lista.innerHTML+=`
      <tr>
        <td>${p.cliente}</td>
        <td>${p.pedido}</td>
        <td>R$ ${fmt(p.valor)}</td>
        <td><span class="badge ${p.status}">${p.status}</span></td>
        <td>
          <button class="btn-small btn-dark" onclick="mudarStatus(${i},'Em rota')">Em rota ðŸ“²</button>
          <button class="btn-small btn-dark" onclick="mudarStatus(${i},'Entregue')">Entregue ðŸ“²</button>
          <button class="btn-small btn-danger" onclick="excluirPedido(${i})">Excluir</button>
        </td>
      </tr>`;
  });

  kPedidos.innerText=hojePedidos.length;
  kTotal.innerText=fmt(total);
  kEnt.innerText=ent;
  resumo.innerText=`Total do dia: R$ ${fmt(total)}`;
}
render();
</script>

</body>
</html>
